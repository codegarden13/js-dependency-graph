{
  "meta": {
    "entry": "app/server.js",
    "urlInfo": {
      "url": "http://localhost:3000",
      "status": 200,
      "contentType": "text/html; charset=utf-8"
    }
  },
  "nodes": [
    {
      "id": "app/server.js",
      "file": "app/server.js",
      "lines": 120,
      "complexity": 4,
      "comment": "app/server.js\n\nServer entrypoint\n- Express app + route registration\n- Server logfile per start (via createServerLogger)\n- HTTP access logging to logfile\n- UI log ingestion endpoint: POST /api/log\n- Graceful shutdown (server close + exiftool end)"
    },
    {
      "id": "app/routes/camera.js",
      "file": "app/routes/camera.js",
      "lines": 41,
      "complexity": 5,
      "comment": "app/routes/camera.js\n\nResponsibilities:\n- GET /api/camera: return current camera connection state\n- Keep response shape stable for the frontend poller\n\nResponse (200):\n  { connected: boolean, label: string, mountPoint?: string, dcimPath?: string }\nResponse (500):\n  { connected: false, error: string, details: { message, code } }"
    },
    {
      "id": "app/routes/exposure.js",
      "file": "app/routes/exposure.js",
      "lines": 78,
      "complexity": 18,
      "comment": "routes/exposure.js\n\nResponsibilities:\n- Provide exposure metadata for a given file path\n- Read EXIF via exiftool-vendored\n- Return a small, stable JSON payload for the UI\n\nRoute:\n- GET /api/exposure?path=..."
    },
    {
      "id": "app/routes/scan.js",
      "file": "app/routes/scan.js",
      "lines": 139,
      "complexity": 18,
      "comment": "routes/scan.js\n\nResponsibilities:\n- GET  /api/scan/progress  (polled by frontend)\n- POST /api/scan\n  - Detect camera + profile\n  - Walk DCIM for supported files\n  - Extract timestamps (EXIF or fallback via getDateTime)\n  - Return:\n    - items:    [{ path, ts }] sorted by ts asc  (frontend source-of-truth for gap slider regrouping)\n    - sessions: server-default grouping for instant initial render\n\nHardening:\n- Validates camera detection output (prevents ERR_INVALID_ARG_TYPE)\n- Returns helpful 4xx for “not mounted / not supported”\n- Keeps progress state consistent on all exits"
    },
    {
      "id": "app/routes/preview.js",
      "file": "app/routes/preview.js",
      "lines": 24,
      "complexity": 5,
      "comment": ""
    },
    {
      "id": "app/routes/import.js",
      "file": "app/routes/import.js",
      "lines": 244,
      "complexity": 33,
      "comment": "routes/import.js: Import API Route (Server-Side)\n\nEndpoint:\n  POST /api/import\n\nPurpose:\n  Persist a client-selected photo session from a mounted camera volume into a\n  stable, software-agnostic archive structure under CONFIG.targetRoot.\n\nResponsibilities:\n  - Validate and normalize request payload (files + session timestamp + title)\n  - Enforce supported platforms (macOS/Linux)\n  - Verify targetRoot exists and is writable (mount-safe; never mkdir root)\n  - Create session folder structure:\n      <targetRoot>/<YYYY>/<MM>/<YYYY-MM-DD <title>__<camera>>/{originals,exports}\n  - Copy files into /originals idempotently (skip if destination exists)\n  - Prefix copied filenames with camera label to prevent collisions:\n      <camera>__<originalName>\n  - Write an import log into the session folder (.import.log)\n\nNotes:\n  - The first image timestamp determines the YYYY/MM and session date.\n  - Camera label is used to (a) suffix the session folder and (b) prefix files.\n  - Errors are mapped to HTTP-ish statuses and a stable \"code\" field."
    },
    {
      "id": "app/routes/delete.js",
      "file": "app/routes/delete.js",
      "lines": 54,
      "complexity": 11,
      "comment": ""
    },
    {
      "id": "app/routes/config.js",
      "file": "app/routes/config.js",
      "lines": 20,
      "complexity": 0,
      "comment": "app/routes/config.js\n\nGET /api/config\nExposes only UI-relevant configuration (no secrets)."
    },
    {
      "id": "app/routes/target.js",
      "file": "app/routes/target.js",
      "lines": 101,
      "complexity": 18,
      "comment": "routes/target.js"
    },
    {
      "id": "app/lib/logger.js",
      "file": "app/lib/logger.js",
      "lines": 78,
      "complexity": 12,
      "comment": "app/lib/logger.js\n\nServer logger:\n- creates a new logfile on each server start\n- writes logs to file (+ optionally console)\n- provides an Express handler for /api/log that accepts UI log batches"
    },
    {
      "id": "app/lib/camera.js",
      "file": "app/lib/camera.js",
      "lines": 61,
      "complexity": 18,
      "comment": "lib/camera.js\n\nResponsibilities:\n- Detect a mounted camera volume by name under known volume roots\n- Validate camera profile\n- Return a consistent shape used by /api/camera and /api/scan\n\nReturns: { label, mountPoint, dcimPath, profile } | null"
    },
    {
      "id": "app/lib/scan.js",
      "file": "app/lib/scan.js",
      "lines": 171,
      "complexity": 24,
      "comment": "lib/scan.js\n\nResponsibilities:\n- Walk a camera/DCIM directory and collect supported files\n- Extract a reliable timestamp per file (EXIF preferred, filesystem fallback)\n- Never block indefinitely on EXIF reads\n\nDesign notes:\n- Iterative directory walk (no recursion depth risk)\n- Per-file EXIF timeout to avoid scan hangs\n- Skips common system folders on removable volumes\n- Robust EXIF timestamp extraction (handles ExifDateTime/Date/string)\n- Optional debug logging for EXIF fallbacks (off by default)"
    },
    {
      "id": "app/lib/sessions.js",
      "file": "app/lib/sessions.js",
      "lines": 25,
      "complexity": 4,
      "comment": ""
    },
    {
      "id": "app/config.js",
      "file": "app/config.js",
      "lines": 116,
      "complexity": 16,
      "comment": "app/config.js\n\nGoals:\n- Single source of truth (CONFIG) with clear defaults per platform\n- macOS + Linux supported; Windows explicitly unsupported (but app can still start)\n- Minimal, predictable ENV overrides (trimmed + optional)\n- Camera profiles are immutable and validated via helpers"
    },
    {
      "id": "app/lib/progress.js",
      "file": "app/lib/progress.js",
      "lines": 15,
      "complexity": 0,
      "comment": ""
    },
    {
      "id": "app/lib/fsutil.js",
      "file": "app/lib/fsutil.js",
      "lines": 22,
      "complexity": 2,
      "comment": ""
    },
    {
      "id": "app/lib/preview.js",
      "file": "app/lib/preview.js",
      "lines": 33,
      "complexity": 6,
      "comment": ""
    },
    {
      "id": "app/lib/import.js",
      "file": "app/lib/import.js",
      "lines": 231,
      "complexity": 21,
      "comment": "lib/import.js\n\nResponsibilities:\n- Provide safe, reusable import primitives for the server\n- Treat targetRoot as an existing mount (do NOT mkdir targetRoot)\n- Build YYYY/MM/YYYY-MM-DD Title/{originals,exports} under targetRoot\n- Copy files idempotently (skip if already exists)\n- Provide clear errors for non-existent / non-writable roots"
    }
  ],
  "links": [
    {
      "source": "app/server.js",
      "target": "app/routes/camera.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/exposure.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/scan.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/preview.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/import.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/delete.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/config.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/routes/target.js",
      "type": "use"
    },
    {
      "source": "app/server.js",
      "target": "app/lib/logger.js",
      "type": "use"
    },
    {
      "source": "app/routes/camera.js",
      "target": "app/lib/camera.js",
      "type": "use"
    },
    {
      "source": "app/routes/scan.js",
      "target": "app/lib/camera.js",
      "type": "use"
    },
    {
      "source": "app/routes/scan.js",
      "target": "app/lib/scan.js",
      "type": "use"
    },
    {
      "source": "app/routes/scan.js",
      "target": "app/lib/sessions.js",
      "type": "use"
    },
    {
      "source": "app/routes/scan.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/routes/scan.js",
      "target": "app/lib/progress.js",
      "type": "use"
    },
    {
      "source": "app/routes/preview.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    },
    {
      "source": "app/routes/preview.js",
      "target": "app/lib/preview.js",
      "type": "use"
    },
    {
      "source": "app/routes/import.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/routes/import.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    },
    {
      "source": "app/routes/import.js",
      "target": "app/lib/camera.js",
      "type": "use"
    },
    {
      "source": "app/routes/import.js",
      "target": "app/lib/import.js",
      "type": "use"
    },
    {
      "source": "app/routes/delete.js",
      "target": "app/lib/camera.js",
      "type": "use"
    },
    {
      "source": "app/routes/delete.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    },
    {
      "source": "app/routes/config.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/routes/target.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/lib/camera.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/lib/camera.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    },
    {
      "source": "app/lib/scan.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    },
    {
      "source": "app/lib/fsutil.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/lib/preview.js",
      "target": "app/config.js",
      "type": "use"
    },
    {
      "source": "app/lib/preview.js",
      "target": "app/lib/fsutil.js",
      "type": "use"
    }
  ]
}